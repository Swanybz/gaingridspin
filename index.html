<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GainGrid Spin & Win</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <!-- Monetag SDK -->
  <script src="//libtl.com/sdk.js" data-zone="10176108" data-sdk="show_10176108"></script>
  <style>
    body { box-sizing: border-box; margin:0; padding:0; font-family:'Segoe UI', sans-serif; background: linear-gradient(135deg,#4a148c 0%,#880e4f 100%); color:#fff; min-height:100%; overflow-x:hidden; }
    * { box-sizing:border-box; }
    .container { max-width:600px; margin:0 auto; padding:20px; position:relative; }
    .header { text-align:center; margin-bottom:30px; padding:20px; }
    .header h1 { font-size:32px; margin:0 0 10px 0; text-shadow:2px 2px 4px rgba(0,0,0,0.3); }
    .header p { font-size:16px; margin:0; opacity:0.9; }
    .wheel-container { position:relative; width:100%; max-width:400px; margin:0 auto 30px; aspect-ratio:1; }
    .wheel { width:100%; height:100%; border-radius:50%; position:relative; box-shadow:0 8px 30px rgba(0,0,0,0.5); transition:transform 4s cubic-bezier(0.17,0.67,0.12,0.99); border:8px solid #ffd700; }
    .wheel-segment { position:absolute; width:50%; height:50%; transform-origin:100% 100%; clip-path: polygon(0 0, 100% 0, 100% 100%); display:flex; align-items:flex-start; justify-content:center; font-size:11px; font-weight:bold; text-align:center; padding:15px 5px 5px 5px; overflow:hidden; }
    .segment-text { transform:rotate(-90deg) translateX(-20px); white-space:nowrap; text-shadow:1px 1px 2px rgba(0,0,0,0.5); }
    .wheel-center { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:80px; height:80px; background:linear-gradient(135deg,#ffd700,#ffed4e); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:24px; box-shadow:0 4px 15px rgba(0,0,0,0.4); z-index:10; }
    .wheel-pointer { position:absolute; top:-20px; left:50%; transform:translateX(-50%); width:0; height:0; border-left:20px solid transparent; border-right:20px solid transparent; border-top:40px solid #ec407a; z-index:20; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3)); }
    .vip-status { background: rgba(255,255,255,0.1); border-radius:15px; padding:20px; margin-bottom:25px; text-align:center; backdrop-filter:blur(10px); border:2px solid rgba(255,255,255,0.2); }
    .vip-status h3 { margin:0 0 10px 0; font-size:20px; color:#ffd700; }
    .vip-status p { margin:0; font-size:14px; line-height:1.5; }
    .controls { background: rgba(255,255,255,0.1); border-radius:15px; padding:25px; margin-bottom:25px; backdrop-filter:blur(10px); border:2px solid rgba(255,255,255,0.2); }
    .progress-bar { margin-bottom:20px; }
    .progress-label { display:flex; justify-content:space-between; margin-bottom:8px; font-size:14px; font-weight:bold; }
    .progress-track { width:100%; height:12px; background:rgba(0,0,0,0.3); border-radius:6px; overflow:hidden; }
    .progress-fill { height:100%; background:linear-gradient(90deg,#00e5ff,#ffd700); border-radius:6px; transition:width 0.3s ease; }
    .button { width:100%; padding:16px; margin-bottom:12px; border:none; border-radius:12px; font-size:16px; font-weight:bold; cursor:pointer; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(0,0,0,0.3); }
    .button:hover:not(:disabled){ transform:translateY(-2px); box-shadow:0 6px 20px rgba(0,0,0,0.4); }
    .button:active:not(:disabled){ transform:translateY(0); }
    .button:disabled{ opacity:0.5; cursor:not-allowed; }
    .button-primary{ background:linear-gradient(135deg,#8e24aa,#ab47bc); color:white; }
    .button-secondary{ background:linear-gradient(135deg,#ec407a,#f06292); color:white; }
    .button-tertiary{ background:rgba(255,255,255,0.2); color:white; border:2px solid rgba(255,255,255,0.3); }
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; align-items:center; justify-content:center; padding:20px; }
    .modal.active{ display:flex; }
    .modal-content { background: linear-gradient(135deg,#4a148c,#880e4f); border-radius:20px; padding:40px; max-width:400px; width:100%; text-align:center; box-shadow:0 10px 40px rgba(0,0,0,0.5); border:3px solid #ffd700; animation: modalPop 0.3s ease; }
    @keyframes modalPop { 0%{transform:scale(0.8);opacity:0;}100%{transform:scale(1);opacity:1;} }
    .modal-content h2{ font-size:28px; margin:0 0 15px 0; color:#ffd700; }
    .modal-content p{ font-size:18px; margin:0 0 25px 0; line-height:1.5; }
    .footer { text-align:center; padding:30px 20px; margin-top:40px; border-top:2px solid rgba(255,255,255,0.2); }
    .footer p{ margin:5px 0; font-size:14px; opacity:0.8; }
    .loading{ display:inline-block; width:20px; height:20px; border:3px solid rgba(255,255,255,0.3); border-top-color:white; border-radius:50%; animation:spin 0.8s linear infinite; }
    @keyframes spin{ to{ transform:rotate(360deg); } }
    /* Flying Box */
    #flying-box { position: fixed; width:60px; height:60px; font-size:30px; top:50%; left:50%; transform:translate(-50%,-50%) rotateY(0deg); cursor:pointer; z-index:30; transition:transform 0.3s ease; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 id="main-title">üé° Spin & Win G-Coins!</h1>
      <p id="subtitle">Unlock rewards, rare VIPs, and bonuses. Spin 10x daily!</p>
    </div>
    <div class="wheel-container">
      <div class="wheel-pointer"></div>
      <div class="wheel" id="wheel"></div>
      <div class="wheel-center">üé°</div>
    </div>
    <div id="flying-box">üéÅ</div>
    <div class="vip-status" id="vip-status">
      <h3>VIP Status</h3>
      <p id="vip-message">Loading...</p>
    </div>
    <div class="controls">
      <div class="progress-bar">
        <div class="progress-label"><span>Daily Spins</span> <span id="spins-count">0/10</span></div>
        <div class="progress-track">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
      </div>
      <button class="button button-primary" id="spin-button">üåÄ Spin Now</button>
      <button class="button button-tertiary" id="refresh-button">üîÑ Refresh Wheel</button>
    </div>
  </div>
  <div class="footer">
    <p id="footer-text">¬© GainGrid 2025 | All rights reserved</p>
    <p id="support-links">Telegram Support | Privacy Policy</p>
  </div>
  <div class="modal" id="result-modal">
    <div class="modal-content">
      <h2 id="modal-title">üéâ Congratulations!</h2>
      <p id="modal-message">You won something amazing!</p>
      <button class="button button-primary" id="modal-close">Continue</button>
    </div>
  </div>

<script>
(async function(){
  // -------- Decode payload from URL --------
  function decodeBase64(str){
    try { return JSON.parse(decodeURIComponent(escape(atob(str)))); } 
    catch(e){ console.error("Base64 decode failed:",e); return null; }
  }

  const urlParams = new URLSearchParams(window.location.search);
  let startData = null;
  if(urlParams.has('start')){
    startData = decodeBase64(urlParams.get('start'));
  }

  let userData = startData || { user_id:"anon", vip_level:"free", daily_spins:0, total_spins:10, points:0, session_id:"", callback_url:"", start_immediately:false};
  let isSpinning=false;
  let vipDelayDays=3; // VIP shows only after 3 days
  const wheelSegments=[
    { text:"+50 G-Coins", color:"#8e24aa", value:50, type:"coins" },
    { text:"+100 G-Coins", color:"#ab47bc", value:100, type:"coins" },
    { text:"+200 G-Coins", color:"#ba68c8", value:200, type:"coins" },
    { text:"üéÅ Mystery Box", color:"#ce93d8", value:0, type:"mystery" },
    { text:"ü•â Basic VIP", color:"#ffd700", value:0, type:"vip_basic" },
    { text:"Try Again", color:"#ec407a", value:0, type:"nothing" },
    { text:"üîÅ Spin x2", color:"#f06292", value:0, type:"double_spin" },
    { text:"üî• Bonus x2", color:"#f48fb1", value:0, type:"multiplier" },
    { text:"üßä Cooldown Cut", color:"#00e5ff", value:0, type:"cooldown" },
    { text:"+500 G-Coins", color:"#9c27b0", value:500, type:"coins" }
  ];
  let currentSegments=[...wheelSegments];

  // -------- Initialize Wheel --------
  const wheel=document.getElementById('wheel');
  function renderWheel(){
    wheel.innerHTML="";
    const segAngle=360/currentSegments.length;
    currentSegments.forEach((seg,i)=>{
      const div=document.createElement('div');
      div.className="wheel-segment";
      div.style.background=seg.color;
      div.style.transform=`rotate(${i*segAngle}deg)`;
      const span=document.createElement('span');
      span.className="segment-text"; span.textContent=seg.text;
      div.appendChild(span); wheel.appendChild(div);
    });
  }

  function shuffleWheel(){ currentSegments=[...wheelSegments].sort(()=>Math.random()-0.5); renderWheel(); }

  // -------- Flying Box üéÅ --------
  const box=document.getElementById('flying-box');
  let angleX=0, angleY=0;
  function animateBox(){
    angleX+=0.5; angleY+=0.3;
    const x=Math.sin(angleX/50)*window.innerWidth/2 + window.innerWidth/2 -30;
    const y=Math.sin(angleY/50)*window.innerHeight/2 + window.innerHeight/2 -30;
    box.style.transform=`translate(${x}px,${y}px) rotateY(${angleX}deg)`;
    requestAnimationFrame(animateBox);
  }
  box.onclick=async function(){
    userData.points=(userData.points||0)+3;
    updateUI();
    // Show ad reward
    try { await show_10176108('pop'); console.log("Ad watched via flying box üéÅ"); } catch(e){ console.warn("Ad skipped",e); }
  };
  animateBox();

  // -------- Update UI --------
  function updateVIPStatus(){
    const vipMsg=document.getElementById('vip-message');
    const startDate=new Date(userData.session_id.split("_")[2]||Date.now());
    const now=new Date();
    if((now-startDate)/(1000*60*60*24)<vipDelayDays){ // VIP hidden first 3 days
      vipMsg.textContent="VIP will unlock soon..."; 
    } else {
      switch(userData.vip_level){
        case"free": vipMsg.textContent="You're a Free User"; break;
        case"basic": vipMsg.textContent="ü•â Basic VIP ‚Äî Spin for upgrade"; break;
        case"silver": vipMsg.textContent="ü•à Silver VIP ‚Äî Spin for upgrade"; break;
        case"gold": vipMsg.textContent="ü•á Gold VIP ‚Äî Max tier unlocked"; break;
      }
    }
  }

  function updateUI(){
    const spinsLeft=userData.total_spins-(userData.daily_spins||0);
    document.getElementById('spins-count').textContent=`${spinsLeft}/10`;
    document.getElementById('progress-fill').style.width=`${(spinsLeft/10)*100}%`;
    updateVIPStatus();
  }

  // -------- Spin Wheel --------
  async function spinWheel(){
    if(isSpinning || (userData.daily_spins||0)>=userData.total_spins) return;
    isSpinning=true; const spinBtn=document.getElementById('spin-button'); spinBtn.disabled=true; spinBtn.innerHTML='<span class="loading"></span>';
    const segAngle=360/currentSegments.length;
    const rand=Math.floor(Math.random()*currentSegments.length);
    const targetRot=360*5+(rand*segAngle)+(segAngle/2);
    wheel.style.transform=`rotate(${targetRot}deg)`;
    setTimeout(async()=>{
      const win=currentSegments[rand]; await processWin(win);
      wheel.style.transition='none'; wheel.style.transform='rotate(0deg)'; 
      setTimeout(()=>{ wheel.style.transition='transform 4s cubic-bezier(0.17,0.67,0.12,0.99)'; },50);
      isSpinning=false; spinBtn.disabled=false; spinBtn.innerHTML='üåÄ Spin Now';
      updateUI();
    },4000);
  }

  async function processWin(seg){
    userData.daily_spins=(userData.daily_spins||0)+1;
    let title="üéâ Congratulations!", msg="";
    switch(seg.type){
      case"coins": userData.points=(userData.points||0)+seg.value; title="üí∞ You Won!"; msg=`+${seg.value} G-Coins!`; break;
      case"vip_basic": userData.vip_level="basic"; title="üëë VIP Unlocked!"; msg="ü•â Basic VIP activated!"; break;
      case"mystery": const coins=Math.floor(Math.random()*300)+100; userData.points=(userData.points||0)+coins; title="üéÅ Mystery Box"; msg=`You found +${coins} G-Coins!`; break;
      case"double_spin": userData.daily_spins=(userData.daily_spins||0)-1; title="üîÅ Bonus Spin!"; msg="Extra spin awarded!"; break;
      case"multiplier": title="üî• Multiplier Active!"; msg="Next coin win doubled!"; break;
      case"cooldown": title="üßä Cooldown Cut!"; msg="Spin faster now!"; break;
      case"nothing": title="üòÖ Try Again!"; msg="Better luck next time!"; break;
    }
    showModal(title,msg);
    // Send spin result to bot
    if(userData.callback_url){
      try{ await fetch(userData.callback_url,{ method:"POST", headers:{ "Content-Type":"application/json" }, body:JSON.stringify({ user_id:userData.user_id, spin_result:seg, points:userData.points, vip_level:userData.vip_level, session_id:userData.session_id }) }); } catch(e){ console.warn("Callback failed",e); }
    }
  }

  function showModal(title,msg){
    document.getElementById('modal-title').textContent=title;
    document.getElementById('modal-message').textContent=msg;
    document.getElementById('result-modal').classList.add('active');
  }
// -------- Modal Close --------
  const modalClose = document.getElementById('modal-close');
  modalClose.addEventListener('click', () => {
    document.getElementById('result-modal').classList.remove('active');
  });

  // -------- Refresh Wheel --------
  document.getElementById('refresh-button').addEventListener('click', () => {
    shuffleWheel();
  });

  // -------- Spin Button --------
  document.getElementById('spin-button').addEventListener('click', async () => {
    // Optional: show ad before spin
    try {
      await show_10176108(); // Rewarded interstitial
      console.log("Ad watched before spin ‚úÖ");
    } catch(e){
      console.warn("Ad skipped or failed", e);
    }
    spinWheel();
  });

  // -------- Auto Start if Deeplink Start --------
  if(userData.start_immediately){
    setTimeout(() => { spinWheel(); }, 500); // Start immediately after load
  }

  // -------- Initial Setup --------
  renderWheel();
  updateUI();

  // -------- Optional: Load ads smartlinks after 15 seconds --------
  setTimeout(()=>{
    const iframe1=document.createElement('iframe');
    iframe1.src='https://otieu.com/4/10176185';
    iframe1.style.display='none'; document.body.appendChild(iframe1);
    const iframe2=document.createElement('iframe');
    iframe2.src='https://otieu.com/4/10176155';
    iframe2.style.display='none'; document.body.appendChild(iframe2);
  },15000);

})();
</script>
</body>
</html>